import{E as f,B as E,I as P,e as Q,v as R,Q as q,f as v,h as B}from"./index.7bc43159.js";import{cp as S,d as j,b_ as U,i as F,b$ as O,r as p,C as k,w as z,o as A,aI as G,aQ as M,ae as T,af as u,f as n,bj as c,W as $,al as D,co as H}from"./index.5b1aa9bb.js";import{Q as W,b as J}from"./QCard.ec06072d.js";import{_ as K}from"./LawmaAppBadge.379030a5.js";import{u as b}from"./auth-store.d3e0ecc2.js";import{api as L}from"./axios.5b7f8c90.js";import{U as X}from"./urlPaths.enum.ec3fe997.js";import{I as Y}from"./IsEmail.f856adbb.js";import"./QBadge.70956f48.js";import"./storeforage.9751bfd5.js";async function Z(d){const e=await L.post(X.SIGNIN,d,{headers:{Authorization:void 0}});if([200,201].includes(e.status))return e.data.token;throw new Error("Signin failed",{cause:e.data})}class ee{static async handle(e){e==null||e.on(f.SIGN_IN,async l=>{try{const r=b();delete l.errors;const t=await Z(l);await r.handleAuthToken(t),S.create({message:"Signin successful",color:"positive"})}catch(r){console.log(r),S.create({message:"Signin failed",color:"negative",icon:"warning",timeout:5e3})}})}}var se=Object.defineProperty,te=Object.getOwnPropertyDescriptor,x=(d,e,l,r)=>{for(var t=r>1?void 0:r?te(e,l):e,s=d.length-1,m;s>=0;s--)(m=d[s])&&(t=(r?m(e,l,t):m(t))||t);return r&&t&&se(e,l,t),t};class h extends E{email;password}x([Y({},{message:"Please enter a valid email"})],h.prototype,"email",2);x([P({message:"Password is invalid"})],h.prototype,"password",2);const oe={class:"q-pt-sm q-pl-sm",style:{height:"4rem"}},ae={class:"flex flex-center",style:{height:"100vh"}},re={class:"text-center q-mx-auto"},le={class:"text-center",style:{width:"100%"}},ye=j({__name:"SigninPage",setup(d){U();const e=F("eventBus"),l=b(),{token:r}=O(l);ee.handle(e);const t=p(!1),s=k(new h),m=p(),I=p();Q(async()=>{var a;return await s.validate(),!!((a=s.errors)!=null&&a.length)});function w(a){var g,_;const o=(g=s.errors)==null?void 0:g.find(C=>C.property===a),i=((_=Object.values((o==null?void 0:o.constraints)||{}))==null?void 0:_.join(" & "))||"";return i===""?!0:i}async function N(){var a;(a=s.errors)!=null&&a.length||e.emit(f.SIGN_IN,s)}function V(){y()}function y(){s.email="",s.password=""}return z(r,a=>{if(a){const o="http://localhost:9000";window.location.href=o}}),A(()=>{y()}),G(()=>{e.off(f.SIGN_IN)}),(a,o)=>(M(),T("div",null,[u("div",oe,[n(K,{color:"light-page"})]),u("div",ae,[n(W,{style:$([{width:"30rem",height:"40rem"},{borderColor:`2rem solid ${a.$getColor("accent")}`}]),rounded:""},{default:c(()=>[n(J,null,{default:c(()=>[u("div",re,[n(R,null,{default:c(()=>[D(" Sign in ")]),_:1})]),n(q,{style:{height:"100%",width:"100%"},ref_key:"signinFormRef",ref:m,onSubmit:N,onReset:V,class:"q-gutter-xl q-pt-xl q-px-l"},{default:c(()=>[n(v,{style:{width:"100%"},filled:"",modelValue:s.email,"onUpdate:modelValue":o[0]||(o[0]=i=>s.email=i),label:"Email",hint:"email","lazy-rules":"",rules:[()=>w("email")]},null,8,["modelValue","rules"]),n(v,{style:{width:"100%"},filled:"",type:t.value?"text":"password",modelValue:s.password,"onUpdate:modelValue":o[1]||(o[1]=i=>s.password=i),label:"Password","lazy-rules":"",rules:[()=>w("password")],ref_key:"emailRef",ref:I},null,8,["type","modelValue","rules"]),n(B,{style:{"margin-top":"-2rem"},modelValue:t.value,"onUpdate:modelValue":o[2]||(o[2]=i=>t.value=i),label:"Show password"},null,8,["modelValue"]),u("div",le,[n(H,{style:{width:"100%"},label:"Submit",type:"submit",color:"primary",rounded:""})])]),_:1},512)]),_:1})]),_:1},8,["style"])])]))}});export{ye as default};
