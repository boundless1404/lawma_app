import{E as f,B as E,I as P,d as R,f as j,Q as q,e as v}from"./index.8a3139b3.js";import{Q as B}from"./QCheckbox.bfca5131.js";import{ck as S,d as U,b_ as k,i as F,b$ as O,r as p,C as z,w as A,o as G,aI as M,aQ as T,ae as $,af as u,f as n,bj as c,W as D,al as H,cj as W}from"./index.ed6ac60f.js";import{Q as J,b as K}from"./QCard.f7564384.js";import{_ as L}from"./LawmaAppBadge.63bd7c9a.js";import{u as b}from"./auth-store.37cbfd44.js";import{api as X}from"./axios.55c0c053.js";import{U as Y}from"./urlPaths.enum.9088486d.js";import{I as Z}from"./IsEmail.c020840c.js";import"./QBadge.c62ff391.js";import"./storeforage.994c5aeb.js";async function ee(d){const s=await X.post(Y.SIGNIN,d,{headers:{Authorization:void 0}});if([200,201].includes(s.status))return s.data.token;throw new Error("Signin failed",{cause:s.data})}class se{static async handle(s){s==null||s.on(f.SIGN_IN,async t=>{try{const r=b();delete t.errors;const o=await ee(t);await r.handleAuthToken(o),S.create({message:"Signin successful",color:"positive"})}catch(r){console.log(r),S.create({message:"Signin failed",color:"negative",icon:"warning",timeout:5e3})}})}}var te=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,x=(d,s,t,r)=>{for(var o=r>1?void 0:r?oe(s,t):s,m=d.length-1,e;m>=0;m--)(e=d[m])&&(o=(r?e(s,t,o):e(o))||o);return r&&o&&te(s,t,o),o};class h extends E{email;password}x([Z({},{message:"Please enter a valid email"})],h.prototype,"email",2);x([P({message:"Password is invalid"})],h.prototype,"password",2);const ae={class:"q-pt-sm q-pl-sm",style:{height:"4rem"}},re={class:"flex flex-center",style:{height:"100vh"}},le={class:"text-center q-mx-auto"},ne={class:"text-center",style:{width:"100%"}},_e=U({__name:"SigninPage",setup(d){const s=k(),t=F("eventBus"),r=b(),{token:o}=O(r);se.handle(t);const m=p(!1),e=z(new h),I=p(),N=p();R(async()=>{var a;return await e.validate(),!!((a=e.errors)!=null&&a.length)});function w(a){var g,_;const l=(g=e.errors)==null?void 0:g.find(C=>C.property===a),i=((_=Object.values((l==null?void 0:l.constraints)||{}))==null?void 0:_.join(" & "))||"";return i===""?!0:i}async function V(){var a;(a=e.errors)!=null&&a.length||t.emit(f.SIGN_IN,e)}function Q(){y()}function y(){e.email="",e.password=""}return A(o,a=>{a&&s.push("/")}),G(()=>{y()}),M(()=>{t.off(f.SIGN_IN)}),(a,l)=>(T(),$("div",null,[u("div",ae,[n(L,{color:"light-page"})]),u("div",re,[n(J,{style:D([{width:"30rem",height:"40rem"},{borderColor:`2rem solid ${a.$getColor("accent")}`}]),rounded:""},{default:c(()=>[n(K,null,{default:c(()=>[u("div",le,[n(j,null,{default:c(()=>[H(" Sign in ")]),_:1})]),n(q,{style:{height:"100%",width:"100%"},ref_key:"signinFormRef",ref:I,onSubmit:V,onReset:Q,class:"q-gutter-xl q-pt-xl q-px-l"},{default:c(()=>[n(v,{style:{width:"100%"},filled:"",modelValue:e.email,"onUpdate:modelValue":l[0]||(l[0]=i=>e.email=i),label:"Email",hint:"email","lazy-rules":"",rules:[()=>w("email")]},null,8,["modelValue","rules"]),n(v,{style:{width:"100%"},filled:"",type:m.value?"text":"password",modelValue:e.password,"onUpdate:modelValue":l[1]||(l[1]=i=>e.password=i),label:"Password","lazy-rules":"",rules:[()=>w("password")],ref_key:"emailRef",ref:N},null,8,["type","modelValue","rules"]),n(B,{style:{"margin-top":"-2rem"},modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=i=>m.value=i),label:"Show password"},null,8,["modelValue"]),u("div",ne,[n(W,{style:{width:"100%"},label:"Submit",type:"submit",color:"primary",rounded:""})])]),_:1},512)]),_:1})]),_:1},8,["style"])])]))}});export{_e as default};
